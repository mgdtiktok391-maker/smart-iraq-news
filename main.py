# -*- coding: utf-8 -*-
import os, re, time, random, json, html, hashlib
from datetime import datetime, date, timedelta
from zoneinfo import ZoneInfo

import requests
import backoff
import feedparser
from apscheduler.schedulers.background import BackgroundScheduler

from google.oauth2.credentials import Credentials
from googleapiclient.discovery import build

import markdown as md
import bleach

from flask import Flask, request, jsonify

# =================== إعدادات عامة ===================
TZ = ZoneInfo("Asia/Baghdad")

# ⏰ أوقات النشر المعدّلة (بتوقيت بغداد)
POST_TIMES_LOCAL = ["09:00", "17:00"]  # مقالان يوميًا

SAFE_CALLS_PER_MIN = int(os.getenv("SAFE_CALLS_PER_MIN", "3"))
AI_MAX_RETRIES = int(os.getenv("AI_MAX_RETRIES", "3"))
AI_BACKOFF_BASE = int(os.getenv("AI_BACKOFF_BASE", "4"))

# أسرار أساسية
GEMINI_API_KEY = os.environ["GEMINI_API_KEY"]
BLOG_URL = os.environ["BLOG_URL"]
CLIENT_ID = os.environ["CLIENT_ID"]
CLIENT_SECRET = os.environ["CLIENT_SECRET"]
REFRESH_TOKEN = os.environ["REFRESH_TOKEN"]

# =================== مواضيع احتياطية (40 موضوعًا) ===================
FALLBACK_TOPICS = [
    "مستقبل الذكاء الاصطناعي في العالم العربي",
    "كيف تغيّر الخوارزميات طريقة اتخاذ القرار",
    "أثر التكنولوجيا على التعليم الجامعي",
    "التحول الرقمي في المؤسسات الحكومية",
    "الأمن السيبراني في عصر العمل عن بُعد",
    "البيانات الضخمة ودورها في الاقتصاد الحديث",
    "أخلاقيات الذكاء الاصطناعي وتحدياتها",
    "مفهوم المدن الذكية وتطبيقاته الواقعية",
    "كيف تؤثر الأتمتة على سوق العمل",
    "الفرق بين الذكاء الاصطناعي الضيق والعام",
    "الحوسبة السحابية ومستقبل الشركات",
    "أهمية الثقافة الرقمية في القرن 21",
    "التحول الرقمي في القطاع الصحي",
    "كيف تعمل محركات البحث من الداخل",
    "الاقتصاد الرقمي ونماذج الأعمال الجديدة",
    "دور التكنولوجيا في مكافحة الفساد",
    "التعليم الإلكتروني: الفرص والتحديات",
    "الذكاء الاصطناعي وصناعة المحتوى",
    "كيف غيّرت التكنولوجيا مفهوم الخصوصية",
    "التكنولوجيا المالية FinTech وتأثيرها",
    "العمل الحر في العصر الرقمي",
    "الذكاء الاصطناعي في التحليل السياسي",
    "الابتكار التقني في الدول النامية",
    "تاريخ الإنترنت وتحولاته الكبرى",
    "كيف تؤثر المنصات الرقمية على الرأي العام",
    "التحول الرقمي وبناء رأس المال البشري",
    "التكنولوجيا والعدالة الاجتماعية",
    "الذكاء الاصطناعي وصنع السياسات العامة",
    "تحديات الأمن الرقمي في الشرق الأوسط",
    "مستقبل البرمجة بدون كود",
    "كيف غيّر الذكاء الاصطناعي البحث العلمي",
    "الاقتصاد المعرفي وأسس التنمية",
    "التكنولوجيا وتأثيرها على الهوية الثقافية",
    "التحول الرقمي في الإعلام",
    "الذكاء الاصطناعي في التنبؤ الاقتصادي",
    "أهمية التفكير النقدي في العصر الرقمي",
    "التكنولوجيا بين التقدم والمخاطر",
    "دور الابتكار في نهضة الأمم",
    "مستقبل الذكاء الاصطناعي التوليدي",
    "كيف تعيد الثورة الرقمية تشكيل العالم"
]

# =================== (بقية كودك كما هو بدون تغيير) ===================
# ⬇⬇⬇ كل ما تبقّى من الشيفرة يبقى كما أرسلته أنت حرفيًا ⬇⬇⬇
# لم يتم حذف أو كسر أي دالة أو منطق
